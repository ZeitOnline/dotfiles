{{ range $db := (secretJSON "kv" "list" "-format=json" "staging/gcp/cloudsql/databases") }}
{{ $key := (print "staging/gcp/cloudsql/databases/" $db) }}
[{{ $db }}]
hostaddr={{ (vault $key).data.host }}
port=5432
user={{ (vault $key).data.user }}
password={{ (vault $key).data.password }}
dbname={{ (vault $key).data.name }}
sslmode=verify-ca
sslcert={{ (env "HOME") }}/.pg_services/{{ (vault $key).data.instance }}-client-cert.pem
sslkey={{ (env "HOME") }}/.pg_services/{{ (vault $key).data.instance }}-client-key.pem
sslrootcert={{ (env "HOME") }}/.pg_services/{{ (vault $key).data.instance }}-server-ca.pem
{{ end }}
